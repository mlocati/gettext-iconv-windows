From: Michele Locati <michele@locati.it>
Date: Sun, 18 Jan 2026 20:23:50 +0100
Subject: [PATCH] Add VERSIONINFO to libjson-c.dll

--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -429,6 +429,13 @@ set(JSON_C_SOURCES
     ${PROJECT_SOURCE_DIR}/strerror_override.c
 )
 
+set(JSON_C_RESOURCES)
+
+if (BUILD_SHARED_LIBS AND WIN32)
+    enable_language(RC)
+    set(JSON_C_RESOURCES ${JSON_C_RESOURCES} ${PROJECT_SOURCE_DIR}/libjson.rc)
+endif()
+
 if (NOT DISABLE_JSON_POINTER)
     set(JSON_C_PUBLIC_HEADERS   ${JSON_C_PUBLIC_HEADERS}  ${PROJECT_SOURCE_DIR}/json_pointer.h)
     set(JSON_C_SOURCES          ${JSON_C_SOURCES}         ${PROJECT_SOURCE_DIR}/json_pointer.c)
@@ -468,6 +475,7 @@ endif()
 add_library(${PROJECT_NAME}
     ${JSON_C_SOURCES}
     ${JSON_C_HEADERS}
+    ${JSON_C_RESOURCES}
 )
 set_target_properties(${PROJECT_NAME} PROPERTIES
     VERSION 5.4.0
--- /dev/null
+++ b/libjson.rc
@@ -0,0 +1,37 @@
+#include <winver.h>
+#include "json_c_version.h"
+
+VS_VERSION_INFO VERSIONINFO
+FILEVERSION JSON_C_MAJOR_VERSION,JSON_C_MINOR_VERSION,JSON_C_MICRO_VERSION,0
+PRODUCTVERSION JSON_C_MAJOR_VERSION,JSON_C_MINOR_VERSION,JSON_C_MICRO_VERSION,0
+FILEFLAGSMASK VS_FFI_FILEFLAGSMASK
+#ifdef _DEBUG
+FILEFLAGS VS_FF_DEBUG
+#else
+FILEFLAGS 0x0L
+#endif
+FILEOS VOS_DOS_WINDOWS32
+FILETYPE VFT_DLL
+FILESUBTYPE VFT2_UNKNOWN
+BEGIN
+    BLOCK "StringFileInfo"
+    BEGIN
+        BLOCK "04090000"  /* Lang = US English, Charset = ASCII */
+        BEGIN
+            VALUE "Comments", "A JSON implementation in C\0"
+            VALUE "CompanyName", "Eric Haszlakiewicz\0"
+            VALUE "FileDescription", "JSON-C\0"
+            VALUE "FileVersion", JSON_C_VERSION "\0"
+            VALUE "InternalName", "libjson-c.dll\0"
+            VALUE "LegalCopyright", "MIT License, 2009-2012\0"
+            VALUE "LegalTrademarks", "\0"
+            VALUE "OriginalFilename", "libjson-c.dll\0"
+            VALUE "ProductName", "JSON-C\0"
+            VALUE "ProductVersion", JSON_C_VERSION "\0"
+        END
+    END
+    BLOCK "VarFileInfo"
+    BEGIN
+        VALUE "Translation", 0x0409, 0  /* US English, ASCII */
+    END
+END
